# Production configuration with all settings tuned
# Suitable for deployment behind a load balancer

[project]
name = "production-api"
version = "1.0.0"
description = "Production-ready API service"

[[project.authors]]
name = "Your Name"
email = "you@example.com"

[server]
# Auto-tune disabled for predictable behavior
auto = false
port = 8080

# Module directories
modules = "modules/"
scripts = "scripts/"              # Optional: JS orchestration
static = "public/"                # Optional: static files

# Cache settings (tuned for production)
cache_size = 100                  # Max cached modules
max_cache_mb = 512                # 512MB cache limit

# Request limits
max_body_size_mb = 10             # 10MB max request body
execution_timeout_secs = 30       # 30s handler timeout
max_concurrent_requests = 2000    # Global concurrency limit
max_per_module_requests = 50      # Per-module limit

# Lifecycle
shutdown_timeout_secs = 60        # 60s graceful shutdown

# Logging
log_max_size_mb = 50              # 50MB before rotation
log_max_files = 10                # Keep 10 rotated logs

# Hot reload (disable in production)
watch_debounce_ms = 0             # 0 = disable file watching

# Outgoing HTTP allowlist
http_allowed = [
    "api.internal.example.com",
    "*.supabase.co",
]

[composition]
http_handler = true

[tracing]
enabled = true
service_name = "production-api"
otlp_endpoint = "http://tempo:4317"  # OTLP collector

[dependencies]
"myorg/router" = "v2.0.0"
"myorg/auth" = "v1.5.0"
