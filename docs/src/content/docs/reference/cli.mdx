---
title: CLI Reference
description: mik command line interface reference
---

The `mik` CLI provides commands for creating, building, and running WASI HTTP projects. It includes an embedded runtime, so you only need one binary.

## Installation

```bash
cargo install mik
```

## Commands

### mik new

Create a new mik project with all required files.

```bash
mik new <NAME> [OPTIONS]
```

**Options:**
| Flag | Description |
|------|-------------|
| `--lib` | Initialize as a library (default: handler) |

**Example:**

```bash
mik new my-api
cd my-api
mik build -rc
mik run
```

**Generated structure:**

```
my-api/
├── Cargo.toml          # Component package
├── mik.toml            # Project config
├── wit/
│   ├── world.wit       # WIT world definition
│   └── deps/core/      # Core handler interface
├── src/
│   └── lib.rs          # Handler implementation
├── modules/            # Dependencies directory
└── .gitignore
```

---

### mik build

Build the WASM handler and optionally compose with bridge.

```bash
mik build [OPTIONS]
```

**Options:**
| Flag | Description |
|------|-------------|
| `-r, --release` | Build with optimizations |
| `-c, --compose` | Compose with HTTP bridge |

**Examples:**

```bash
# Debug build
mik build

# Release build
mik build -r

# Release build + compose with bridge
mik build -rc
```

**Output:**

- `target/wasm32-wasip2/release/<name>.wasm` - Compiled handler
- `dist/<name>-composed.wasm` - Composed component (with `-c`)

---

### mik dev

Start development server with watch mode and embedded services.

```bash
mik dev [OPTIONS]
```

**Options:**
| Flag | Description |
|------|-------------|
| `--port <PORT>` | Server port (default: 3000) |
| `--no-services` | Skip starting embedded services |

**Features:**

- Auto-rebuilds on source changes (watch mode)
- Auto-starts daemon for embedded services (KV, SQL, Storage, Cron)
- Runs in foreground with nice output
- Graceful shutdown on Ctrl+C

**Example:**

```bash
mik dev                    # Watch mode on port 3000
mik dev --port 8080        # Custom port
mik dev --no-services      # Skip embedded services
```

**Output:**

```
Starting development server...

Services available at http://127.0.0.1:9919
  KV:      /kv/:key
  SQL:     /sql/query, /sql/execute
  Storage: /storage/*path
  Cron:    /cron

Watching for changes...
Server: http://127.0.0.1:3000
Press Ctrl+C to stop
```

---

### mik run

Start the HTTP server with the embedded runtime.

```bash
mik run [COMPONENT] [OPTIONS]
```

**Arguments:**
| Argument | Description |
|----------|-------------|
| `COMPONENT` | Optional path to a .wasm file |

**Options:**
| Flag | Description |
|------|-------------|
| `--port <PORT>` | Server port (default: 3000) |
| `--workers <N>` | Number of worker processes (0 = auto) |
| `--lb` | Enable integrated L7 load balancer |
| `--local` | Bind to localhost only |
| `--detach` | Run as background instance with services |
| `--name <NAME>` | Instance name when detached (default: "default") |

**Modes:**

All modes use consistent `/run/<module>/*` routing.

**Foreground mode** (default):

```bash
mik run                    # Multi-module from mik.toml
mik run dist/api.wasm      # Single component
```

**Detached mode** (background with services):

```bash
mik run --detach           # Background instance
mik run --detach --name prod --port 8080
```

Auto-starts daemon if not running. Use `mik ps` to list instances.

**Multi-worker mode** (for performance):

```bash
mik run --workers 4 --lb   # LB on 3000, workers on 3001-3004
mik run --workers 0 --lb   # Auto-detect workers
```

**Example output:**

```
Starting server on http://127.0.0.1:3000
Routes: /run/my-api/* -> component
Health: /health
Metrics: /metrics
```

**Built-in endpoints:**
| Endpoint | Description |
|----------|-------------|
| `/health` | Health check |
| `/metrics` | Prometheus metrics |
| `/static/*` | Static files (if configured) |

---

### mik add

Add a dependency to the project.

```bash
mik add <PACKAGE> [OPTIONS]
```

**Package formats:**

```
user/repo              # OCI: ghcr.io/user/repo:latest
user/repo:tag          # OCI: ghcr.io/user/repo:tag
```

**Options:**
| Flag | Description |
|------|-------------|
| `--git <URL>` | Git repository URL |
| `--path <PATH>` | Local path |
| `--tag <TAG>` | OCI/Git tag |
| `--branch <BRANCH>` | Git branch |

**Examples:**

```bash
# Add from OCI registry
mik add dufeutech/router

# Add with specific version
mik add dufeutech/router:v1.0.0

# Add from git
mik add my-component --git "https://github.com/user/repo.git"

# Add local dependency
mik add my-handler --path "../my-handler"
```

---

### mik remove

Remove a dependency from the project.

```bash
mik remove <PACKAGE>
```

---

### mik sync

Synchronize dependencies from registries.

```bash
mik sync
```

Downloads missing dependencies and removes stale modules from `modules/`.

**When to use:**

- After `git clone` to download all dependencies
- After switching branches
- To clean up unused modules

---

### mik cache

Manage the AOT compilation cache.

```bash
mik cache <SUBCOMMAND>
```

**Subcommands:**
| Command | Description |
|---------|-------------|
| `info` | Show cache statistics |
| `clean` | Remove stale entries |
| `clear` | Clear all cached data |

---

### mik completions

Generate shell completion scripts for tab completion support.

```bash
mik completions <SHELL>
```

**Supported shells:** `bash`, `zsh`, `fish`, `powershell`, `elvish`

**Installation:**

```bash
# Bash
mik completions bash > ~/.local/share/bash-completion/completions/mik

# Zsh (add fpath+=~/.zfunc to .zshrc first)
mik completions zsh > ~/.zfunc/_mik

# Fish
mik completions fish > ~/.config/fish/completions/mik.fish

# PowerShell
mik completions powershell >> $PROFILE
```

---

## Instance Management

Commands for managing background WASM instances. The daemon is auto-managed - it starts automatically when needed and stops when the last instance is stopped.

### mik stop

Stop a running instance.

```bash
mik stop [NAME]
```

**Arguments:**
| Argument | Description |
|----------|-------------|
| `NAME` | Instance name (default: "default") |

**Example:**

```bash
mik stop              # Stop "default" instance
mik stop prod         # Stop named instance
```

When the last instance is stopped, the daemon automatically exits.

---

### mik ps

List all instances.

```bash
mik ps
```

**Example output:**

```
NAME         PORT   PID      STATUS     UPTIME
────────────────────────────────────────────────────────
default      3000   12345    running    2h 15m
dev          3001   12346    running    45m
```

---

### mik logs

View instance logs.

```bash
mik logs [NAME] [OPTIONS]
```

**Options:**
| Flag | Description |
|------|-------------|
| `-f, --follow` | Follow log output |
| `-n, --lines <N>` | Number of lines (default: 50) |

---

## Environment Variables

| Variable         | Description                                  |
| ---------------- | -------------------------------------------- |
| `PORT`           | Override server port                         |
| `HOST`           | Bind address (default: 127.0.0.1)            |
| `RUST_LOG`       | Log level (error, warn, info, debug, trace)  |
| `MIK_HOT_RELOAD` | Enable hot reload mode                       |
| `MIK_API_KEY`    | API key for daemon authentication (optional) |

---

## Workflow Examples

### Development Workflow

```bash
# 1. Create project
mik new my-api
cd my-api

# 2. Build with composition
mik build -rc

# 3. Start development server (watch mode + services)
mik dev

# 4. Test
curl http://localhost:3000/health
curl http://localhost:3000/run/my-api/
```

### Production-like Testing

```bash
# Multi-worker with load balancer
mik run --workers 4 --lb

# Or run as background instance
mik run --detach --name prod
mik ps                    # Check status
mik logs prod -f          # Follow logs
mik stop prod             # Stop when done
```

### After Cloning

```bash
git clone https://github.com/user/my-api.git
cd my-api
mik sync        # Download all dependencies
mik build -rc
mik dev         # Start development
```
